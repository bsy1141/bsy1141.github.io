+++
date = '2025-09-07T17:16:05+09:00'
draft = false
title = 'Webpack Compiler hooks란?'
tags = ['webpack']
description = "Hugo 블로그 사용법과 Webpack Compiler hooks에 대한 상세한 설명을 제공합니다. 정적 사이트 생성기와 웹팩의 컴파일 과정을 이해해보세요."
+++

### Webpack Compiler hooks 란?

- webpack의 컴파일 과정에서 **특정 시점**에 사용자가 정의한 기능을 수행하고 싶을 수 있음 → 해당 로직을 가능하게 만드는 hook이라고 생각하면 됨.
- 즉, Webpack의 전체 빌드 라이프사이클 중 시점에 사용자가 직접 정의한 로직을 삽입할 수 있도록 제공되는 이벤트 기반 인터페이스
- `compiler` 객체로 접근 가능

  - webpack 함수는 webpack 설정 객체를 제공하며, 콜백함수가 제공되면 webpack 컴파일러를 실행

    ```jsx
    const webpack = require("webpack");

    webpack({}, (err, stats) => {
      if (err || stats.hasErrors()) {
        // ...
      }
      // 프로세싱 완료
    });
    ```

  - 컴파일러 객체로 특정 hook을 호출할 수 있으므로, 컴파일러 객체가 무엇인지 알아야 호출 가능한 것이 아닌가?

    ```jsx
    const webpack = require("webpack");

    // 컴파일러 객체 생성 완료 ~
    const compiler = webpack({
      /* 옵션 */
    });
    ```

### 기본적인 사용 방법

- 아래에서 소개할 라이프 사이클 훅들은 compiler에 의해 노출됩니다. 아래와 같이 접근 할 수 있습니다.
- `tap`은 hook에 함수를 등록하는 방식이며, `'MyPlugin'`은 디버깅용 식별자입니다.
- 훅 타입에 따라서 tapAsync와 tapPromise를 사용할 수 있습니다.

```jsx
const webpack = require("webpack");

// 컴파일러 객체 생성 완료 ~
const compiler = webpack({
  /* 옵션 */
});

// someHook에 다른 종류의 hook이 위치함
compiler.hooks.someHook.tap("MyPlugin", (params) => {
  /* ... */
});
```

### 잘 사용되는 Webpack Compiler Hooks 예시

| Hook 이름     | 발생 시점                                    | 주 용도                              |
| ------------- | -------------------------------------------- | ------------------------------------ |
| `beforeRun`   | Webpack 실행 전에 호출                       | 초기화, 로그, 캐시 체크              |
| `run`         | 컴파일 시작 직전에 실행 (watch 모드 아닐 때) | 외부 빌드 트리거                     |
| `watchRun`    | `watch` 모드에서 파일 변경 감지 후 실행      | 감시용 로직, 변경된 파일 추적        |
| `compile`     | `compilation` 객체 생성 직전                 | `compilation` 설정 초기화            |
| `compilation` | `compilation` 객체가 생성될 때               | 내부 hooks 연결 (e.g. asset 가공 등) |
| `emit`        | 결과물이 파일로 쓰이기 직전                  | 파일 추가, 변경, 삭제 등             |
| `afterEmit`   | emit 직후 실행됨                             | 로그, 후처리                         |
| `done`        | 빌드가 모두 끝났을 때                        | 완료 알림, 요약 로그, 종료 처리      |

### 빌드 완료 시점에 특정 로직을 실행하려면?

- 저희 팀에서는 서버 사이드 렌더링(SSR) 을 사용하는 일부 웹 애플리케이션을 운영하고 있습니다. SSR 환경에서는 서버에서 직접 빌드된 자바스크립트 파일을 읽어와야 하기 때문에, 일반적인 메모리 기반 빌드 파일 관리가 적합하지 않을 때가 있습니다. 그래서 빌드 파일을 실제 disk 경로에 저장하는 방식으로 운영하고 있습니다.
- 개발 모드 시(HMR)에도 역시 해당 빌드 파일을 읽어오는 방식이므로, 빌드 파일이 없더라도 webpack 컴파일 시, 빌드 완료 이후 app.js 실행을 기대하였지만 그렇게 진행되지 않았습니다.
- 따라서 `done` compiler hook을 이용하여 빌드 완료 시점에 app start 될 수 있도록 수정하였습니다.

**참고 자료**

- https://webpack.kr/api/compiler-hooks/
